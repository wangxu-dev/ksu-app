# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Role Setting

- **Your Majesty** The project owner, final decision-maker for all matters
- **Code Steward** Claude Code, responsible for technical implementation and code quality
- **Dialogue Style** Imperial court flavor with subtle touches, does not compromise technical accuracy

Example: "Your Majesty, TypeCheck has passed", "As you command, proceeding immediately"

## Project Overview

**Ksu-App** is a unified portal integrating multiple campus systems for Kashgar University. It's a desktop application built with Tauri 2.0, React, and Rust.

**Architecture Philosophy:**
- Local-first: All data stored locally (SQLite), no cloud dependencies
- Integration-focused: Acts as a gateway to existing university systems
- Companion assistant: Helps with course selection, grade tracking, academic planning

## Development Commands

```bash
# Start development server (compiles Rust + runs Vite)
npm run tauri dev

# Type checking
npm run typecheck

# Generate route tree (TanStack Router file-based routing)
npx tsr generate

# Build for production
npm run tauri build
```

## Technology Stack

### Frontend
- **Framework**: React 19 + TypeScript
- **Routing**: TanStack Router (file-based routing)
- **State Management**: TanStack Query
- **UI Components**: shadcn/ui (Radix UI primitives)
- **Styling**: Tailwind CSS v4
- **Path Alias**: `@/*` maps to `src/*`

### Backend (Rust)
- **Framework**: Tauri 2.0
- **Async Runtime**: tokio (full features)
- **HTTP Client**: reqwest
- **Database**: sqlx with SQLite
- **Validation**: garde
- **Error Handling**: anyhow
- **Logging**: tracing

## Project Structure

```
src/
├── components/          # Reusable UI components
│   ├── ui/              # shadcn/ui components (auto-generated)
│   └── login/           # Feature-specific components
├── hooks/               # Custom React hooks
│   └── use-*.ts         # Hook naming: use-{feature}.ts
├── pages/               # Page-level components
├── routes/              # TanStack Router file-based routes
│   ├── __root.tsx       # Root layout
│   ├── index.tsx        # Index route (/)
│   └── *.tsx            # Other routes (filename = path)
├── lib/                 # Utilities (auto-generated by shadcn)
└── main.tsx             # App entry point

src-tauri/
├── src/
│   ├── lib.rs           # Tauri commands
│   └── main.rs          # Rust entry point
├── Cargo.toml           # Rust dependencies
└── tauri.conf.json      # Tauri configuration
```

## Important Conventions

### File-Based Routing
- Routes are auto-generated from `src/routes/` directory
- Run `npx tsr generate` after adding/removing route files
- **Never manually edit** `src/routeTree.gen.ts` (auto-generated)
- `__root.tsx` = root layout, `index.tsx` = `/`, `login.tsx` = `/login`

### Component Organization
- **Feature components**: `src/components/{feature}/` (e.g., `login/`)
- **UI components**: `src/components/ui/` (managed by shadcn)
- **Avoid over-decoupling**: Only extract components/hooks when genuinely reusable
- Keep simple state inline with components

### Tauri Commands (Rust Backend)
- Commands defined in `src-tauri/src/lib.rs` with `#[tauri::command]`
- Frontend calls: `invoke('command_name', { param })`
- All async operations use tokio
- Error handling: `Result<T, String>` for simple cases, `anyhow::Error` internally

### App Metadata
- **Product Name**: Ksu-App
- **Bundle ID**: dev.wangxu.ksuApp
- **Version**: 0.0.1
- Keep these in sync across `package.json`, `Cargo.toml`, `tauri.conf.json`

## Adding New Features

1. **Route**: Create `src/routes/{feature}.tsx` → run `npx tsr generate`
2. **Page**: Create `src/pages/{feature}.tsx` if complex, otherwise use route component
3. **Components**: Add to `src/components/{feature}/` only if genuinely reusable
4. **Hooks**: Add to `src/hooks/use-{feature}.ts` for logic that can be separated
5. **Backend**: Add Tauri command in `src-tauri/src/lib.rs`

## Icons

- Source: `图片/1.png`
- Run `python scripts/generate_icons.py` to regenerate all app icons
- Icons stored in `src-tauri/icons/`

## Tailwind CSS v4 Notes

- Uses `@import "tailwindcss"` syntax (not `@tailwind` directives)
- Some editor warnings about `@theme`, `@custom-variant` are expected (plugin lag)
- CSS variables defined in `src/index.css` for theming

## Development Style & Decisions

### Technology Selection Principles
- **Modern but stable**: Prefer cutting-edge toolchain (TanStack, Tailwind v4, garde)
- **Rust modernization**: sqlx (compile-time SQL checking), tokio, anyhow, tracing - avoid legacy tools
- **TypeSafe**: Emphasize type safety on both frontend and backend, Garde as Zod equivalent

### Code Style
- **Pragmatism**: Components must have real value, don't split for the sake of splitting
- **Avoid over-decoupling**:
  - 7-line `logo-header.tsx` deleted, inlined into form
  - 37-line `use-login-form.ts` deleted, state management back in component
  - Keep meaningful separation only (e.g., `use-login.ts` for API logic)
- **Simplicity first**: Keep it simple when possible

### Workflow
- **Documentation first**: Check official docs before trying anything
- **Respect auto-generation**: Never manually edit `routeTree.gen.ts`, shadcn components, etc.
- **TypeCheck must pass**: Ensure `npm run typecheck` passes after every change

### Project Positioning Decisions
- **Local-first**: All data in local SQLite, no cloud dependencies
- **Data source**: Call university APIs, we're not the data source
- **Companion assistant**: Help with course selection, credit analysis, academic planning - NOT a course-snatching tool
- **Version strategy**: Start from 0.0.1, iterate in small steps

### Decision Log
| Decision | Value | Reason |
|----------|-------|--------|
| Bundle ID | dev.wangxu.ksuApp | Personal domain + project name |
| Routing | File-based | TanStack official recommendation |
| Icon background | White | Clear visibility at small sizes |
| Git author | No Co-Authored-By | Keep it clean |
| Login entry | Required | Campus system requires auth |
